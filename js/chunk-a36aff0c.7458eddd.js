(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a36aff0c"],{"0a0d":function(e,t,a){e.exports=a("e829")},"2f37":function(e,t,a){var r=a("63b6");r(r.S,"Date",{now:function(){return(new Date).getTime()}})},"563b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",[a("h1",[e._v(e._s(this.$route.params.productSubName)+"--销售计划")]),a("Divider",{attrs:{dashed:""}}),a("Form",{ref:"vo",attrs:{model:e.vo,rules:e.ruleValidate,"label-width":85}},[a("Row",[a("i-col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"市场价",prop:"marketPrice"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:0,formatter:function(e){return""+e/100},parser:function(e){return""+parseInt((100*e).toFixed(2))}},model:{value:e.vo.marketPrice,callback:function(t){e.$set(e.vo,"marketPrice",t)},expression:"vo.marketPrice"}})],1)],1),a("i-col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"最低价",prop:"lowPrice"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:0,formatter:function(e){return""+e/100},parser:function(e){return""+parseInt((100*e).toFixed(2))}},model:{value:e.vo.lowPrice,callback:function(t){e.$set(e.vo,"lowPrice",t)},expression:"vo.lowPrice"}})],1)],1)],1),a("Row",[a("i-col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"结算价",prop:"settlePrice"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:0,formatter:function(e){return""+e/100},parser:function(e){return""+parseInt((100*e).toFixed(2))}},model:{value:e.vo.settlePrice,callback:function(t){e.$set(e.vo,"settlePrice",t)},expression:"vo.settlePrice"}})],1)],1),a("i-col",{attrs:{span:"8"}},[a("FormItem",{attrs:{label:"库存",prop:"stock"}},[a("InputNumber",{staticStyle:{width:"200px"},attrs:{min:1},model:{value:e.vo.stock,callback:function(t){e.$set(e.vo,"stock",t)},expression:"vo.stock"}})],1)],1)],1),a("Divider",{attrs:{dashed:""}}),a("FormItem",{attrs:{label:"退货规则",prop:"refundId"}},[a("Select",{staticStyle:{width:"200px"},model:{value:e.vo.refundId,callback:function(t){e.$set(e.vo,"refundId",t)},expression:"vo.refundId"}},e._l(e.refundRuleList,function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),a("FormItem",{attrs:{label:"售卖规则",prop:"saleRuleType"}},[a("RadioGroup",{model:{value:e.vo.saleRuleType,callback:function(t){e.$set(e.vo,"saleRuleType",t)},expression:"vo.saleRuleType"}},[a("Radio",{attrs:{label:5060}},[e._v("不允许超卖")]),a("Radio",{attrs:{label:5061}},[e._v("允许超卖")]),a("Radio",{attrs:{label:5062}},[e._v("超卖需审核")]),a("Radio",{attrs:{label:5063}},[e._v("必须审核（全人工，不走库存）")]),a("Radio",{attrs:{label:5064}},[e._v("必须审核（允许超卖）")]),a("Radio",{attrs:{label:5065}},[e._v("必须审核（不允许超卖）")])],1)],1),a("Divider",{attrs:{dashed:""}}),a("FormItem",{attrs:{label:"禁用星期",prop:"disableWeeks"}},[a("CheckboxGroup",{model:{value:e.vo.disableWeeks,callback:function(t){e.$set(e.vo,"disableWeeks",t)},expression:"vo.disableWeeks"}},e._l(e.Weeks,function(e){return a("Checkbox",{key:e,attrs:{label:e}})}),1)],1),a("FormItem",{attrs:{label:"禁用日期",prop:"disableDate"}},[a("Row",[a("DatePicker",{attrs:{type:"date"},on:{"on-change":e.changDate}})],1),a("Row",[a("Input",{staticStyle:{width:"50%"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:8},placeholder:"选择禁用日期",readonly:""},model:{value:e.vo.disableDate,callback:function(t){e.$set(e.vo,"disableDate",t)},expression:"vo.disableDate"}})],1)],1),a("Divider",{attrs:{dashed:""}}),a("FormItem",{attrs:{label:"售卖时间",prop:"dateRange"}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{options:e.disDate,format:"yyyy-MM-dd",type:"daterange",placement:"bottom-start",placeholder:"选择售卖时间段"},model:{value:e.vo.dateRange,callback:function(t){e.$set(e.vo,"dateRange",t)},expression:"vo.dateRange"}})],1),a("FormItem",{attrs:{label:"是否按时间段",prop:"isTime"}},[a("RadioGroup",{model:{value:e.isTime,callback:function(t){e.isTime=t},expression:"isTime"}},[a("Radio",{attrs:{label:1}},[e._v("是")]),a("Radio",{attrs:{label:0}},[e._v("否")])],1)],1),1===e.isTime?a("Row",[e._l(e.vo.timeRange,function(t,r){return a("FormItem",{key:r,attrs:{label:"时间段"+t.index,prop:"timeRange."+r+".timeRan",rules:{required:!0,message:"时间段不能为空"}}},[a("TimePicker",{staticStyle:{width:"168px"},attrs:{format:"HH:mm",type:"timerange",placement:"bottom-end",placeholder:"请选择时间段"},model:{value:t.timeRan,callback:function(a){e.$set(t,"timeRan",a)},expression:"item.timeRan"}})],1)}),a("FormItem",[a("Row",[a("i-col",{attrs:{span:"2"}},[a("Button",{attrs:{type:"dashed",long:"",icon:"md-add"},on:{click:e.handleAdd}},[e._v("添加")])],1),a("i-col",{attrs:{span:"2",offset:"1"}},[a("Button",{attrs:{type:"dashed",long:"",icon:"md-remove"},on:{click:e.handleRemove}},[e._v("删除")])],1)],1)],1)],2):e._e(),a("FormItem",{attrs:{label:"预订使用限制",prop:"effectiveType"}},[a("RadioGroup",{model:{value:e.vo.bookingLimit,callback:function(t){e.$set(e.vo,"bookingLimit",t)},expression:"vo.bookingLimit"}},[a("Radio",{attrs:{label:1}},[e._v("是")]),a("Radio",{attrs:{label:0}},[e._v("否")])],1),1===e.vo.bookingLimit?a("Row",[a("i-col",{attrs:{span:"6"}},[e._v("游玩前\n                    "),a("InputNumber",{staticStyle:{width:"20%"},attrs:{min:1},model:{value:e.vo.bookingDayLimit,callback:function(t){e.$set(e.vo,"bookingDayLimit",t)},expression:"vo.bookingDayLimit"}}),e._v("天\n                    "),a("TimePicker",{staticStyle:{width:"168px"},attrs:{format:"HH:mm",placement:"bottom-end",placeholder:""},model:{value:e.vo.bookingTimeLimit,callback:function(t){e.$set(e.vo,"bookingTimeLimit",t)},expression:"vo.bookingTimeLimit"}}),e._v("时:分之前预订。\n                ")],1),a("i-col",{attrs:{span:"6"}},[e._v("游玩当天\n                    "),a("InputNumber",{staticStyle:{width:"20%"},attrs:{min:0},model:{value:e.vo.useSecondLimit,callback:function(t){e.$set(e.vo,"useSecondLimit",t)},expression:"vo.useSecondLimit"}}),e._v("秒后可用\n                ")],1)],1):e._e()],1),"2002"===e.vo.ticketFlag?a("FormItem",{attrs:{label:"预定时间限制天",prop:"minPrice"}},[a("InputNumber",{staticStyle:{width:"98%"},attrs:{min:1},model:{value:e.vo.lowPrice,callback:function(t){e.$set(e.vo,"lowPrice",t)},expression:"vo.lowPrice"}}),e._v("/天\n        ")],1):e._e(),a("FormItem",{attrs:{label:"有效天数",prop:"effectiveType"}},[a("RadioGroup",{staticStyle:{"margin-right":"83px"},model:{value:e.vo.effectiveType,callback:function(t){e.$set(e.vo,"effectiveType",t)},expression:"vo.effectiveType"}},[a("Radio",{attrs:{label:1}},[e._v("预订起\n                    "),a("InputNumber",{staticStyle:{width:"20%"},attrs:{min:1},model:{value:e.vo.effectiveDay,callback:function(t){e.$set(e.vo,"effectiveDay",t)},expression:"vo.effectiveDay"}}),e._v("天有效\n                ")],1),a("Radio",{attrs:{label:2}},[e._v("有效时间\n                    "),a("DatePicker",{attrs:{type:"date"},model:{value:e.vo.effectiveStartDate,callback:function(t){e.$set(e.vo,"effectiveStartDate",t)},expression:"vo.effectiveStartDate"}}),e._v("     至     \n                    "),a("DatePicker",{attrs:{type:"date"},model:{value:e.vo.effectiveEndDate,callback:function(t){e.$set(e.vo,"effectiveEndDate",t)},expression:"vo.effectiveEndDate"}})],1)],1)],1),a("FormItem",{staticStyle:{"margin-left":"250px"}},[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit()}}},[e._v("提交")]),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){t.preventDefault(),e.$router.go(-1)}}},[e._v("返回")])],1)],1)],1)},i=[],n=a("75fc"),o=a("774e"),s=a.n(o),l=(a("c5f6"),a("6b54"),a("f576"),a("7f7f"),a("5d73")),c=a.n(l),u=(a("96cf"),a("3b8d")),d=a("e814"),m=a.n(d),v=a("0a0d"),p=a.n(v),f=a("f600"),b={name:"TicketPlan",data:function(){return{disDate:{disabledDate:function(e){return e&&e.valueOf()<p()()-864e5}},index:1,isTime:null,Weeks:f["s"],dateRange:[],vo:{id:null,productSubId:null,productId:null,marketPrice:null,lowPrice:null,settlePrice:null,refundId:null,saleRuleType:null,bookingLimit:null,bookingDayLimit:null,bookingTimeLimit:null,useSecondLimit:null,effectiveDay:null,effectiveStartDate:null,effectiveEndDate:null,effectiveType:null,disableWeek:null,disableWeeks:[],disableDate:null,beginDay:null,endDay:null,stock:null,timeRange:[],dateRange:[]},refundRuleList:[],ruleValidate:{marketPrice:[{required:!0,message:"请输入市场价"}],lowPrice:[{required:!0,message:"请输入最低价"}],settlePrice:[{required:!0,message:"请输入结算价"}],saleRuleType:[{required:!0,message:"请输入售卖规则"}],refundId:[{required:!0,message:"请输入售卖规则"}],stock:[{required:!0,message:"请输入库存"}],dateRange:[{required:!0,validator:function(e,t,a){""!==t[0]&&""!==t[1]||a(new Error("请输入时间段"))}}]}}},watch:{"vo.disableWeeks":{handler:function(e){var t=f["s"].map(function(t){return e.some(function(e){return e===t})?1:0}).join("");this.vo.disableWeek=m()(t,2)},deep:!0},isTime:{handler:function(e){0===e&&(this.vo.timeRange=[])}}},created:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.vo.productId=this.$route.params.productId,this.vo.productSubId=this.$route.params.productSubId,e.next=4,this.get("api/refund/rules/list");case 4:t=e.sent,t.success&&(this.refundRuleList=t.value);case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{handleSubmit:function(){var e=Object(u["a"])(regeneratorRuntime.mark(function e(){var t,a,r,i,n,o,s,l,u,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$refs.vo.validate(),!t){e.next=57;break}if(!(this.vo.lowPrice<this.vo.settlePrice)){e.next=6;break}return this.$Message.error("最低价不能小于结算价"),e.abrupt("return");case 6:if(!(this.vo.marketPrice<this.vo.lowPrice)){e.next=9;break}return this.$Message.error("市场价不能小于最低价"),e.abrupt("return");case 9:if(a=this.vo.timeRange.length,0===a){e.next=51;break}r=!0,i=!1,n=void 0,e.prev=14,o=c()(this.vo.timeRange);case 16:if(r=(s=o.next()).done){e.next=25;break}if(l=s.value,console.log(l),""!==l.timeRan[0]){e.next=22;break}return this.$Message.error("填入时间段有误!"),e.abrupt("return");case 22:r=!0,e.next=16;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e["catch"](14),i=!0,n=e.t0;case 31:e.prev=31,e.prev=32,r||null==o.return||o.return();case 34:if(e.prev=34,!i){e.next=37;break}throw n;case 37:return e.finish(34);case 38:return e.finish(31);case 39:if(!(a>1)){e.next=51;break}u=1;case 41:if(!(u<a)){e.next=51;break}if(!(this.vo.timeRange[u].timeRan[0]<this.vo.timeRange[u-1].timeRan[1])){e.next=45;break}return this.$Message.error("时间段有重合!"),e.abrupt("return");case 45:if(!(this.vo.timeRange[u].timeRan[0]<this.vo.timeRange[u].timeRan[1])){e.next=48;break}return this.$Message.error("开始时间不能等于结束时间!"),e.abrupt("return");case 48:u++,e.next=41;break;case 51:return e.next=53,this.post("/api/product/plan/add",this.vo);case 53:d=e.sent,d.success&&this.$router.back(),e.next=58;break;case 57:this.$Message.error("表单验证失败");case 58:case"end":return e.stop()}},e,this,[[14,27,31,39],[32,,34,38]])}));function t(){return e.apply(this,arguments)}return t}(),changDate:function(e){""!==e&&null!==e&&(null===this.vo.disableDate?this.vo.disableDate=e:this.vo.disableDate="".concat(this.vo.disableDate,",").concat(e))},handleReset:function(e){this.$refs[e].resetFields()},handleAdd:function(){this.vo.timeRange.push({timeRan:[],index:this.index}),this.index++},handleRemove:function(){this.vo.timeRange.pop()},transformDeliveryDate:function(e){var t=Number(e).toString(2).padStart(7,"0");return s()(t).reduce(function(e,t,a){return[].concat(Object(n["a"])(e),Object(n["a"])("1"===t?[f["s"][a]]:[]))},[])}}},h=b,k=a("2877"),x=Object(k["a"])(h,r,i,!1,null,null,null);x.options.__file="ticket-plan.vue";t["default"]=x.exports},"5d6b":function(e,t,a){var r=a("e53d").parseInt,i=a("a1ce").trim,n=a("e692"),o=/^[-+]?0[xX]/;e.exports=8!==r(n+"08")||22!==r(n+"0x16")?function(e,t){var a=i(String(e),3);return r(a,t>>>0||(o.test(a)?16:10))}:r},7445:function(e,t,a){var r=a("63b6"),i=a("5d6b");r(r.G+r.F*(parseInt!=i),{parseInt:i})},b9e9:function(e,t,a){a("7445"),e.exports=a("584a").parseInt},e814:function(e,t,a){e.exports=a("b9e9")},e829:function(e,t,a){a("2f37"),e.exports=a("584a").Date.now}}]);
//# sourceMappingURL=chunk-a36aff0c.7458eddd.js.map