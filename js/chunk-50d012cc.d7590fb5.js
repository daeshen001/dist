(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50d012cc"],{3021:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Dropdown",{staticClass:"search-select",style:{width:e.valueWidth},attrs:{trigger:"custom",visible:e.visible}},[a("Input",{style:{width:e.inputWidth},attrs:{icon:e.loading?"ios-loading":null,readonly:e.loading,"enter-button":e.enterButton,placeholder:e.placeholder,search:""},on:{input:function(t){e.$emit("input",t)},"on-blur":e.blurHandler,"on-focus":e.focusHandler,"on-search":e.query},model:{value:e.val,callback:function(t){e.val=t},expression:"val"}}),a("DropdownMenu",{style:e.selectStyle,attrs:{slot:"list"},slot:"list"},e._l(e.data,function(t,r){return a("DropdownItem",{key:r,attrs:{disabled:t.disabled,divided:t.divided,name:t.name},nativeOn:{click:function(a){a.stopPropagation(),e.clickHandler(t)}}},[e._v(e._s(t.name))])}),1)],1)},n=[],i=(a("96cf"),a("3b8d")),s=(a("7f7f"),a("c5f6"),{name:"SearchSelect",props:{width:{type:[Number,String],default:150},selectWidth:{type:[Number,String],default:150},selectStyle:{type:Object},placeholder:{type:String},onSearch:{type:Function,required:!0},value:{type:[String,Number]},enterButton:{type:[Boolean,String],default:!1}},data:function(){return{visible:!1,val:this.value,loading:!1,data:[]}},computed:{inputWidth:function(){return this.width?"string"===typeof this.width?this.width:"".concat(this.width,"px"):"auto"},valueWidth:function(){return this.selectWidth?"string"===typeof this.selectWidth?this.selectWidth:"".concat(this.selectWidth,"px"):"auto"}},methods:{clear:function(){this.val=null,this.data=[]},clickHandler:function(e){this.visible=!1,this.val=e.name,this.$emit("input",e.id),this.$emit("change",e)},focusHandler:function(){this.data&&this.data.length&&(this.visible=!0),this.$emit("focus")},blurHandler:function(){var e=this;setTimeout(function(){return e.visible=!1},100),this.$emit("blur")},query:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.onSearch(t);case 4:this.data=e.sent,this.visible=!!(null===(a=this.data)||void 0===a?void 0:a.length);case 6:return e.prev=6,this.loading=!1,e.finish(6);case 9:case"end":return e.stop()}},e,this,[[1,,6,9]])}));function t(t){return e.apply(this,arguments)}return t}()}}),o=s,l=(a("48ed"),a("2877")),c=Object(l["a"])(o,r,n,!1,null,null,null);c.options.__file="search-select.vue";t["a"]=c.exports},"48ed":function(e,t,a){"use strict";var r=a("72e1"),n=a.n(r);n.a},"72e1":function(e,t,a){},a80e:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",[a("Form",{ref:"formValidate",staticStyle:{"margin-top":"20px"},attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":100}},[a("FormItem",{staticStyle:{width:"600px"},attrs:{label:"活动名称",prop:"name"}},[a("i-input",{attrs:{placeholder:"输入您要发布的活动名称"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),a("FormItem",{attrs:{label:"活动开始时间",prop:"startDate"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择开始时间和日期"},model:{value:e.formValidate.startDate,callback:function(t){e.$set(e.formValidate,"startDate",t)},expression:"formValidate.startDate"}})],1),a("FormItem",{attrs:{label:"活动结束时间",prop:"endDate"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择结束时间和日期"},model:{value:e.formValidate.endDate,callback:function(t){e.$set(e.formValidate,"endDate",t)},expression:"formValidate.endDate"}})],1),a("FormItem",{attrs:{label:"积分有效开始",prop:"pointsStartDate"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择开始时间和日期"},model:{value:e.formValidate.pointsStartDate,callback:function(t){e.$set(e.formValidate,"pointsStartDate",t)},expression:"formValidate.pointsStartDate"}})],1),a("FormItem",{attrs:{label:"积分有效结束",prop:"pointsEndDate"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择结束时间和日期"},model:{value:e.formValidate.pointsEndDate,callback:function(t){e.$set(e.formValidate,"pointsEndDate",t)},expression:"formValidate.pointsEndDate"}})],1),a("FormItem",{staticStyle:{width:"400px"},attrs:{label:"活动类型",prop:"type"}},[a("Select",{attrs:{placeholder:"选择对应的资源商"},model:{value:e.formValidate.type,callback:function(t){e.$set(e.formValidate,"type",t)},expression:"formValidate.type"}},e._l(e.ActivityType,function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)],1),a("FormItem",{attrs:{label:"派发对象"}},[a("Transfer",{attrs:{data:e.shareEpList,"target-keys":e.shareEpKeyList,filterable:"","filter-method":e.filterMethod},on:{"on-change":e.transferChange}})],1),a("FormItem",{attrs:{label:"活动说明",prop:"content"}},[a("i-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"输入活动的说明内容..."},model:{value:e.formValidate.content,callback:function(t){e.$set(e.formValidate,"content",t)},expression:"formValidate.content"}})],1),a("FormItem",{attrs:{label:"活动宣传模板"}},[-1===e.getLastSavePageAttr.dataId?a("p",[a("Button",{on:{click:function(){return e.selectTemplate()}}},[e._v("选择&编辑...")]),e._v("\n                 \n                "),a("Button",{on:{click:function(){return e.useDefinedTemplate()}}},[e._v("自定义内容...")])],1):e._e(),-1!==e.getLastSavePageAttr.dataId?a("p",[e._v("\n                "+e._s(e.getLastSavePageAttr.title)+" "),a("a",{on:{click:e.clearPublishAttr}},[e._v("清除")])]):e._e()]),a("FormItem",{attrs:{label:"立即发布？",prop:"pubState"}},[a("i-switch",{attrs:{size:"large"},on:{"on-change":e.changePubState},model:{value:e.formValidate.pubState,callback:function(t){e.$set(e.formValidate,"pubState",t)},expression:"formValidate.pubState"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e.isShow?a("FormItem",{attrs:{label:"活动发布时间",prop:"publishTime"}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"datetime",placeholder:"选择活动的具体发布时间"},model:{value:e.formValidate.publishTime,callback:function(t){e.$set(e.formValidate,"publishTime",t)},expression:"formValidate.publishTime"}})],1):e._e(),e.parentState?e._e():a("FormItem",[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("提 交")]),a("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(t){e.handleReset("formValidate")}}},[e._v("重 置")])],1)],1),a("Drawer",{attrs:{title:"模板库",width:"720","mask-closable":!1,styles:{backgroundColor:"#eee"}},model:{value:e.showTemplateStore,callback:function(t){e.showTemplateStore=t},expression:"showTemplateStore"}},[a("template-store",{attrs:{spancount:8,usedbutton:!0,viewbutton:!0},on:{usedtemplateconfig:function(t){return e.usedtemplate(t)},viewtemplateconfig:function(t){return e.viewtemplate(t)}}})],1),a("Modal",{attrs:{fullscreen:""},model:{value:e.showTemplateCenter,callback:function(t){e.showTemplateCenter=t},expression:"showTemplateCenter"}},[a("template-center",{ref:"TemplateController",attrs:{"use-type":e.useType,"use-template-index":e.useTemplateIndex},on:{publishsuccess:e.publishsuccess}}),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)},n=[],i=a("a4bb"),s=a.n(i),o=(a("ac6a"),a("7f7f"),a("5d73")),l=a.n(o),c=(a("96cf"),a("3b8d")),u=a("cebc"),p=a("f600"),d=a("3021"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Select",{attrs:{multiple:"",filterable:"",remote:"","remote-method":e.query}},e._l(e.data,function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])}),1)},m=[],f=(a("c5f6"),{name:"BatchSearchSelect",props:{width:{type:[Number,String],default:150},onBatchSelectSearch:{type:Function,required:!0}},data:function(){return{data:[],loading:!1}},methods:{query:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.onBatchSelectSearch(t);case 4:this.data=e.sent;case 5:return e.prev=5,this.loading=!1,e.finish(5);case 8:case"end":return e.stop()}},e,this,[[1,,5,8]])}));function t(t){return e.apply(this,arguments)}return t}()}}),b=f,g=a("2877"),v=Object(g["a"])(b,h,m,!1,null,null,null);v.options.__file="search-batch-select.vue";var y=v.exports,w=a("88ec"),S=a("e81a"),T=a("9b48"),x=a("2f62"),D={name:"ContentPublish",components:{SearchSelect:d["a"],BatchSearchSelect:y,TemplateStore:S["a"],TemplateCenter:T["default"]},props:{parentState:{type:Boolean,default:!1}},data:function(){return{ActivityType:p["a"],isShow:!1,showTemplateCenter:!1,useType:"",useTemplateIndex:-1,showTemplateStore:!1,shareEpList:[],shareEpKeyList:[],formValidate:{name:"",startDate:"",endDate:"",pointsStartDate:"",pointsEndDate:"",type:"",content:"",publishTime:"",pubState:!0},ruleValidate:{name:[{required:!0,message:"活动名称不能为空",trigger:"blur"}],epIds:[{required:!0,type:"number",message:"活动分发商不能为空，并且必须从列表中选择",trigger:"change"}],startDate:[{required:!0,type:"date",message:"活动的开始日期不能为空",trigger:"change"}],endDate:[{required:!0,type:"date",message:"活动结束日期不能为空",trigger:"change"}],pointsStartDate:[{required:!0,type:"date",message:"积分有效期开始日期不能为空",trigger:"change"}],pointsEndDate:[{required:!0,type:"date",message:"积分有效期结束日期不能为空",trigger:"change"}],type:[{required:!0,type:"number",message:"选择对应的活动类型",trigger:"change"}],content:[{required:!0,message:"活动内容不能为空",trigger:"change"}],publishTime:[{required:!0,type:"date",message:"发布时间不能为空",trigger:"blur"}]}}},computed:Object(u["a"])({},Object(x["c"])(["getLastSavePageAttr"])),mounted:function(){this.getShareEpData()},methods:{historyQiniuList:function(){},selectTemplate:function(){""!==this.formValidate.content.trim()?this.showTemplateStore=!0:this.$Message.warning("确认活动内容后才能编辑推广内容!")},viewtemplate:function(e){this.useType="view",this.showTemplateCenter=!0,this.$refs.TemplateController.useTemplate(e)},usedtemplate:function(e){this.useType="use",this.showTemplateCenter=!0,this.$refs.TemplateController.useTemplate(e)},clearPublishAttr:function(){this.$store.commit("clearLastSavePageAttr")},useDefinedTemplate:function(){""!==this.formValidate.content.trim()?(this.useType="use",this.showTemplateCenter=!0,this.$refs.TemplateController.useTemplate(0)):this.$Message.warning("确认活动内容后才能编辑推广内容!")},transferChange:function(e,t,a){this.shareEpKeyList=e},filterMethod:function(e,t){return e.label.indexOf(t)>-1},getShareEpData:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t,a,r,n,i,s,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.get("/api/nmedia/role/list?epType=".concat(p["l"][1].id,"&pageNum=1&pageSize=50"));case 2:for(t=e.sent,a=!0,r=!1,n=void 0,e.prev=6,i=l()(t.value.list);!(a=(s=i.next()).done);a=!0)o=s.value,this.shareEpList.push({key:o.id,label:o.name});e.next=14;break;case 10:e.prev=10,e.t0=e["catch"](6),r=!0,n=e.t0;case 14:e.prev=14,e.prev=15,a||null==i.return||i.return();case 17:if(e.prev=17,!r){e.next=20;break}throw n;case 20:return e.finish(17);case 21:return e.finish(14);case 22:case"end":return e.stop()}},e,this,[[6,10,14,22],[15,,17,21]])}));function t(){return e.apply(this,arguments)}return t}(),publishsuccess:function(){this.showTemplateCenter=!1,this.showTemplateStore=!1,this.$Notice.success({title:"内容保存成功",desc:"对应的活动发布成功后，可以上活动列表查看具体内容"})},handleSubmit:function(e){var t=this;this.$refs[e].validate(function(e){e?t.submitData():t.$Message.error("表单数据验证不通过，请重新输入!")})},submitData:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(0!==this.shareEpKeyList.length){e.next=4;break}return this.$Message.warning("活动分发商不能为空!"),e.abrupt("return");case 4:if(-1!==this.getLastSavePageAttr.dataId){e.next=7;break}return this.$Message.warning("活动对外的内容不能为空!"),e.abrupt("return");case 7:return this.formValidate.qiniuId=this.getLastSavePageAttr.dataId,this.formValidate.toIds=this.shareEpKeyList,e.next=12,this.post("/api/nmedia/content",this.formValidate);case 12:t=e.sent,t.success?this.$Message.success("活动发布成功!"):this.$Message.error("活动发布失败，请稍候再试!");case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleReset:function(e){this.$refs[e].resetFields()},onSearch:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.get("/api/ep/list?epType=4&name=".concat(t));case 2:return a=e.sent,e.abrupt("return",a.value);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),onBatchSelectSearch:function(){var e=Object(c["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.get("/api/ep/list?epType=4&name=".concat(t));case 2:return a=e.sent,e.abrupt("return",a.value);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),changePubState:function(e){this.isShow=!this.isShow},initModifyData:function(e){var t=this;s()(this.formValidate).forEach(function(a){return t.formValidate[a]=e[a]}),this.formValidate.startDate=Object(w["a"])(e.startDate),this.formValidate.endDate=Object(w["a"])(e.endDate),this.formValidate.pointsStartDate=Object(w["a"])(e.pointsStartDate),this.formValidate.pointsEndDate=Object(w["a"])(e.pointsEndDate),this.formValidate.publishTime=Object(w["a"])(e.publishTime)},submitModifyData:function(){console.log(this.formValidate)}}},k=D,V=Object(g["a"])(k,r,n,!1,null,null,null);V.options.__file="pub.vue";t["default"]=V.exports},e81a:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Row",{attrs:{gutter:16}},e._l(e.getBasicTemplateList,function(t,r){return a("i-col",{key:r,attrs:{span:e.spancount}},[0!==r?a("Card",{staticStyle:{"margin-top":"10px"},attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.name))]),a("img",{attrs:{src:t.smallImage,width:"100%",height:"250"}}),a("Divider"),a("p",[e.usedbutton?a("Button",{on:{click:function(t){e.usedtemplate(r)}}},[e._v("使用")]):e._e(),e.viewbutton?a("Button",{style:e.usedbutton?{float:"right"}:"",on:{click:function(t){e.viewtemplate(r)}}},[e._v("预览")]):e._e()],1)],1):e._e()],1)}),1)},n=[],i=a("cebc"),s=(a("c5f6"),a("2f62")),o={name:"templateStore",props:{spancount:{type:Number,default:4},usedbutton:{type:Boolean,default:!1},viewbutton:{type:Boolean,default:!1}},data:function(){return{basicTemplateList:[]}},computed:Object(i["a"])({},Object(s["c"])(["getBasicTemplateList"])),methods:{usedtemplate:function(e){this.$emit("usedtemplateconfig",e)},viewtemplate:function(e){this.$emit("viewtemplateconfig",e)}}},l=o,c=a("2877"),u=Object(c["a"])(l,r,n,!1,null,null,null);u.options.__file="store.vue";t["a"]=u.exports}}]);
//# sourceMappingURL=chunk-50d012cc.d7590fb5.js.map